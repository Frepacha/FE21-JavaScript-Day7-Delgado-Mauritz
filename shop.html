<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - JS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="Style/styles.css" />

</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light mynav">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"> <img src="https://codefactory.wien/wp-content/uploads/2020/12/cropped-CodeFactory-LOGO-September-2020.png" alt="" width="150" height="50" class="d-inline-block align-top">

            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active h4" aria-current="page" href="#">Products</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link h4" href="#">Delivery</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>


    <!-- here ends navbar -->
    <div class="container">

        <h2 class="text-center w-100 my-5 mx-1 p-3 h1 bg-light">Products</h2>


        <div class="products row">
            <div class="product col-12 col-md-6 col-lg-4 text-center fw-bold">
                <p class="product-title h3 m-3">Flower bunsch 1</p>
                <img class="product-image" src="./Images/cherry.jpeg">
                <div class="product-details ">
                    <p class="product-price h4 m-3">€ 20.00</p>
                    <p>Stock: <span class="stock">10</span></p> <!--Here is the stock-->
                    <!--here first button -->
                    <button class="btn btn-primary product-button" type="button">ADD TO CART</button>
                </div>
            </div>
            <div class="product col-12 col-md-6 col-lg-4 text-center fw-bold">
                <p class="product-title h3 m-3">Flower bunsch 2</p>
                <img class="product-image" src="./Images/clavels.jpeg">
                <div class="product-details">
                    <p class="product-price h4 m-3">€ 25.00</p>
                    <p>Stock: <span class="stock">189</span></p><!--Here is the stock-->
                    <!--here second button -->
                    <button class="btn btn-primary product-button" type="button">ADD TO CART</button>
                </div>
            </div>
            <div class="product col-12 col-md-6 col-lg-4 text-center fw-bold">
                <p class="product-title h3 m-3">Flower bunsch 3</p>
                <img class="product-image" src="./Images/rose.jpeg">
                <div class="product-details">
                    <p class="product-price h4 m-3">€ 45.00</p>
                    <p>Stock: <span class="stock">13</span></p><!--Here is the stock-->
                    <!--here third button -->
                    <button class="btn btn-primary product-button" type="button">ADD TO CART</button>
                </div>
            </div>

            <div class="product col-12 col-md-6 col-lg-4 text-center fw-bold">
                <p class="product-title h3 m-3">Flower bunsch 4</p>
                <img class="product-image" src="./Images/tulips.jpeg">
                <div class="product-details">
                    <p class="product-price h4 m-3">€ 50.00</p>
                    <p>Stock: <span class="stock">6</span></p><!--Here is the stock-->
                    <!--here fourth button -->
                    <button class="btn btn-primary product-button" type="button">ADD TO CART</button>
                </div>
            </div>

        </div>

        <!--cart starts here  -->
        <div id="cart" class="mt-5">
            <div class="cart-header h4  border-bottom row">
                <span class="cart-item col-6 mb-3 ">FLOWER</span>
                <span class="cart-price col-3 mb-3">PRICE</span>
                <span class="cart-quantity col-3 mb-3">QUANTITY</span>
            </div>

            <div id="cart-items">
                <!-- empty cart -->
            </div>

            <div id="total" class="cart-total">
                <strong class="cart-total-title">Total</strong>
                <span id="price" class="cart-total-price h4">€0.00</span>
                <p class="cart-total-price d-flex justify-content-end p-4 h4">discount:<span id="discount"></span></p>
                

            </div>




            <div class="d-flex justify-content-center m-4">
                <button id="btn-purchase" class="btn btn-primary btn-purchase" type="button">Check out <br><i class="fa fa-handshake-o" style="font-size:36px;color:white"></i></button>
            </div>
        </div>

    </div>

    <footer class="mynav d-flex justify-content-center align-items-center">
        <span class=" h2">Flower-Factory Shop</span>
    </footer>
    <!--<script src="Script/cart.js"></script> -->
    <script src="Script/cart.js"></script>

    <script>
        function documentReady() {
            // the add to cart Buttons
            let insertBtns = document.getElementsByClassName('product-button');
            for (let i = 0; i < insertBtns.length; i++) {
                let insertBtn = insertBtns[i];
                insertBtn.addEventListener("click", addItem);
            }
            // the + buttons in the cart
            let plusBtns = document.getElementsByClassName('plus');
            for (let i = 0; i < plusBtns.length; i++) {
                let plusBtn = plusBtns[i];
                plusBtn.addEventListener("click", plusQtt);
            }
            // the - buttons in the cart
            let minusBtns = document.getElementsByClassName('minus');
            for (let i = 0; i < minusBtns.length; i++) {
                let minusBtn = minusBtns[i];
                minusBtn.addEventListener("click", minusQtt);
            }
            // the delete button in the cart
            let delItemBtns = document.getElementsByClassName('del');
            for (let i = 0; i < delItemBtns.length; i++) {
                let delBtn = delItemBtns[i];
                delBtn.addEventListener("click", delItem);
            }
            //the purchase button in the cart
            let btnPurchase = document.getElementById("btn-purchase");
            btnPurchase.addEventListener("click", purchase);
        }
        documentReady();

        function addItem(e) {
            let item = e.target.parentElement.parentElement /* let item = e.target.childNodes; */
            console.log(item);
            let title = item.querySelector('.product-title').innerText;
            let price = item.querySelector('.product-price').innerText.replace("€", "");
            let picSrc = item.querySelector('.product-image').src;
            let qtt = item.querySelector(".stock").innerText; // to get stock of items per click
            if (qtt == 0){
                return;
            }
            // console.log(qtt);
            console.log(title, price, picSrc);
            rowCreate(title, price, picSrc);
            updateTotal();
            stockChangeMinus(e);
        }

        function rowCreate(title, price, picSrc) {
            let cartItems = document.getElementById('cart-items');
            let cartItemsNames = cartItems.getElementsByClassName('cart-item-title');
            let cartItemQtt = cartItems.getElementsByClassName('cart-quantity');

            for (let i = 0; i < cartItemsNames.length; i++) {
                if (cartItemsNames[i].innerText == title) {
                    alert("This item already exists in your cart");
                    let qtt = Number(cartItemQtt[i].innerHTML);
                    cartItemQtt[i].innerHTML = qtt + 1;
                    console.log(qtt);
                    updateTotal();
                    return; //it will stop our script
                }
            }

            let item = `

    <div class="cart-row row d-flex ">
        <div class="cart-item col-6 my-3 ">
            <img class="cart-item-image" src="${picSrc}" width="100" height="100">
            <span class="cart-item-title h5 ">${title}</span>
        </div>

        <span class="cart-price col-3 h4 my-3">€ ${price}</span>   

        <div class="cart-qtty-action col-3 d-flex">            
            <i class="minus fa fa-minus-circle my-auto" ></i>            
            <div class="cart-quantity p-4 h4">1</div>            
            <i class="plus fa fa-plus-circle my-auto"></i>        
            <button class="del btn btn-danger rounded-circle  my-auto ms-3 fw-bold" type="button"> X </button>


        </div>
    </div>`;
            let cart = document.getElementById('cart-items'); // with this code we print the functions in ITEN-PRICE_QUANTITY
            cart.innerHTML += item;
            documentReady();
        }

        function updateTotal() {
            let cart = document.getElementById("cart-items");
            let cartRows = cart.getElementsByClassName("cart-row");
            let total = 0; // it will be calculated from zero each time it is updated
            for (let i = 0; i < cartRows.length; i++) {
                let cartRow = cartRows[i];
                let price = parseFloat(cartRow.getElementsByClassName("cart-price")[0].innerText.replace("€", ""));

                //we only need the first one
                let qtt = Number(cartRow.getElementsByClassName("cart-quantity")[0].innerText);
                console.log(price, qtt);
                total += (price * qtt);
                console.log(total);
            }


            total = total.toFixed(2); //toFixed() will help rounding the number to 2 decimals
            let totalElement = document.getElementById("total").querySelector('#price');
            console.log(total);
            totalElement.innerHTML = "€ " + total;
            discount(); //--------------
        }

        function plusQtt(p) {
            let itemPlus = p.target.parentElement.parentElement;
            let cardTitles = itemPlus.querySelector(".cart-item-title").innerText; //query selector is better when you want the .innerText -best used with p.target.parentElement
            let flowerTitles = document.getElementsByClassName("product");
            for (let j = 0; j < flowerTitles.length; j++){
                flowerTitle = flowerTitles[j].querySelector(".product-title").innerText;
                // console.log(flowerTitle)
            if(cardTitles == flowerTitle){
                let qtt = flowerTitles[j].querySelector(".stock").innerText;
                if(qtt == 0){
                return;
            } else {
                qtt--;
                } //wir mussen noch das Minusfunktion bauen, und dann oben in addItem auscommentieren müßen
                flowerTitles[j].querySelector(".stock").innerText = qtt;
            }
        }
            let qtt = Number(itemPlus.querySelector('.cart-quantity').innerHTML);
            itemPlus.querySelector('.cart-quantity').innerHTML = qtt + 1;
            console.log(qtt);
            updateTotal();
        }

        function minusQtt(m) {
            let itemMinus = m.target.parentElement.parentElement;
            let cardTitles = itemMinus.querySelector(".cart-item-title").innerText;
            let flowerTitles = document.getElementsByClassName("product");
            let qtt = Number(itemMinus.querySelector('.cart-quantity').innerHTML);
            for (let k = 0; k < flowerTitles.length; k++){
                flowerTitle = flowerTitles[k].querySelector(".product-title").innerText;
                // console.log(flowerTitle);
            if (cardTitles == flowerTitle){
                let qtt = flowerTitles[k].querySelector(".stock").innerText;
                qtt++;
                // console.log(qtt);
                documentReady();
                flowerTitles[k].querySelector(".stock").innerText = qtt;
            }
            }
            if (qtt == 1) {
                console.log("There shouldn't be 0 products in the cart");
                delItem(m);
            } else {
                itemMinus.querySelector('.cart-quantity').innerHTML = qtt - 1;
                console.log(qtt);
                updateTotal();
            }
        }

function stockChangeMinus(e){
    let stock = e.target.parentElement.parentElement.querySelector(".stock");
    stock.innerText--;
}

        function delItem(d) {
            let cartItem = d.target.parentElement.parentElement;
            let itemQtt = cartItem.querySelector(".cart-quantity").innerText;
            let cartFlowerTitles = cartItem.querySelector(".cart-item-title").innerText;
            let products = document.getElementsByClassName("product");
            for (let z = 0; z < products.length; z++){
                let product = products[z].querySelector(".product-title").innerText;
                if (cartFlowerTitles == product){
                    let qtt = products[z].querySelector(".stock").innerText;
                    documentReady();
                    products[z].querySelector(".stock").innerText = Number(itemQtt) + Number(qtt);
                }
            }
            let delBtnAction = d.target.parentElement.parentElement.remove();
            updateTotal();
            documentReady();
        }

        function purchase() {
            alert("Thank you for buying with us.");
            let cartItems = document.getElementById('cart-items');
            console.log(cartItems);
            while (cartItems.hasChildNodes()) {
                cartItems.removeChild(cartItems.firstChild);
                console.log(cartItems)
            }
            updateTotal();
        }

        function discount() {
            let discpreis = document.getElementById('price').innerText;
            let x = Number(discpreis.replace("€", ""));
            console.log(x)
            if (x >= 100 && x < 150) {
                x = x * 0.9;
                document.getElementById("discount").innerText = " 10%";
            } else if (x >= 150 && x < 200) {
                x  = x * 0.8;
                document.getElementById("discount").innerText = "20%";
            } else {
                x = x * 1;
            }
            document.getElementById("price").innerText = "  €" + x;
            return x // morgen verarbeiten 
        }
        console.log(discount)

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
    </script>


</body>

</html>